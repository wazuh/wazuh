name: "Get last stable version"
description: "Get last stable version for the given arguments"

inputs:
  repo_owner:
    required: true
    description: "Repository owner"
  repo_name:
    required: true
    description: "Repository name"
  testing_version:
    required: true
    description: "Version of the tested package"
  token:
    required: false
    description: "Github token"

outputs:
  latest_stable_version:
    description: "Latest stable version before given testing_version"
    value: ${{ steps.latest-stable-release.outputs.latest-stable-release }}

runs:
  using: "composite"
  steps:
  - name: Get previous last stable release
    id: latest-stable-release
    shell: bash
    run: |
      if [ -d "venv" ]; then
        echo "Using Python venv"
        source venv/bin/activate
        python3 -m pip install requests packaging
      else
        echo "Using global Python"
        python3 -m pip install --break-system-packages requests packaging
      fi
      script_path=$(find . -name "get_last_stable_version.py")
      version=$($script_path \
          -o "${{ inputs.repo_owner }}" \
          -r "${{ inputs.repo_name }}" \
          -v "${{ inputs.testing_version }}" \
          -t "${{ inputs.token }}"
      )
      echo latest-stable-release=$version >> $GITHUB_OUTPUT
