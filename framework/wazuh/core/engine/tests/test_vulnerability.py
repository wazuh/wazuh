from unittest import mock

import pytest
from wazuh.core.engine.models.vulnerability import ScanRequest, Type
from wazuh.core.engine.vulnerability import VulnerabilityModule


class TestVulnerabilityModule:
    """Test class for the VulnerabilityModule functionality."""

    module_class = VulnerabilityModule

    @pytest.fixture
    def client_mock(self) -> mock.AsyncMock:
        """Provide a mock client instance for testing."""
        return mock.AsyncMock()

    @pytest.fixture
    def module_instance(self, client_mock) -> VulnerabilityModule:
        """Provides an instance of VulnerabilityModule with a mocked client for testing."""
        return self.module_class(client=client_mock)

    async def test_send_scan_request(self, client_mock, module_instance: VulnerabilityModule):
        """Check that the VulnerabilityModule `send_scan_request` method works as expected."""
        response = mock.MagicMock()
        response.status_code = 200
        client_mock.post.return_value = response

        await module_instance.send_scan_request(ScanRequest(type=Type.PACKAGE_LIST, packages=[]))
