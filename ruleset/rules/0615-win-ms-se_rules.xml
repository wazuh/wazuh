<!--
  -  Windows Event Channel ruleset for the Microsoft Anti-Malware channel 
  -  Created by Wazuh, Inc.
  -  Copyright (C) 2015-2021, Wazuh Inc.
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.
-->

<!--
  Rules for: 
    Microsoft Anti-Malware channel ID: 63600 - 64099
-->

<var name="MS_FREQ">8</var>

<group name="windows,mse,">

  <rule id="63600" level="0">
    <if_sid>60008</if_sid>
    <field name="win.system.severityValue">^INFORMATION$</field>
    <options>no_full_log</options>
    <description>Microsoft Anti-Malware informational event.</description>
  </rule>

  <rule id="63601" level="0">
    <if_sid>60008</if_sid>
    <field name="win.system.severityValue">^WARNING$</field>
    <options>no_full_log</options>
    <description>Microsoft Anti-Malware warning event.</description>
    <group>gpg13_4.12,</group>
  </rule>

  <rule id="63602" level="5">
    <if_sid>60008</if_sid>
    <field name="win.system.severityValue">^ERROR$</field>
    <options>no_full_log</options>
    <description>Microsoft Anti-Malware error event.</description>
    <group>system_error,gpg13_4.3,gdpr_IV_35.7.d,</group>
  </rule>

 <!-- MS SE rules -->

  <rule id="63603" level="12">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^1118$|^1119$</field>
    <options>no_full_log</options>
    <description>Microsoft security essentials - Virus detected, but unable to remove.</description>
    <group>virus,pci_dss_5.1,pci_dss_5.2,pci_dss_10.6.1,pci_dss_11.4,gpg13_4.2,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_SI.3,nist_800_53_AU.6,nist_800_53_SI.4,tsc_A1.2,tsc_CC7.2,tsc_CC7.3,tsc_CC6.1,tsc_CC6.8,</group>
  </rule>

  <rule id="63604" level="7">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^1107$</field>
    <options>no_full_log</options>
    <description>Microsoft security essentials - Virus detected and properly removed.</description>
    <group>virus,pci_dss_5.1,pci_dss_5.2,pci_dss_10.6.1,pci_dss_11.4,gpg13_4.2,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_SI.3,nist_800_53_AU.6,nist_800_53_SI.4,tsc_A1.2,tsc_CC7.2,tsc_CC7.3,tsc_CC6.1,tsc_CC6.8,</group>
  </rule>

  <rule id="63605" level="7">
    <if_sid>63601</if_sid>
    <field name="win.system.eventID">^1119$|^1118$|^1117$|^1116$</field>
    <options>no_full_log</options>
    <description>Microsoft security essentials - Virus detected.</description>
    <group>virus,pci_dss_5.1,pci_dss_5.2,pci_dss_10.6.1,pci_dss_11.4,gpg13_4.2,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_SI.3,nist_800_53_AU.6,nist_800_53_SI.4,tsc_A1.2,tsc_CC7.2,tsc_CC7.3,tsc_CC6.1,tsc_CC6.8,</group>
  </rule>

   <rule id="63606" level="7">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^1015$</field>
    <options>no_full_log</options>
    <description>Microsoft security essentials - Suspicious activity detected.</description>
    <group>virus,pci_dss_5.1,pci_dss_5.2,pci_dss_10.6.1,pci_dss_11.4,gpg13_4.2,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_SI.3,nist_800_53_AU.6,nist_800_53_SI.4,tsc_A1.2,tsc_CC7.2,tsc_CC7.3,tsc_CC6.1,tsc_CC6.8,</group>
  </rule>

  <rule id="63607" level="3">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^5007$</field>
    <description>Microsoft security essentials - Configuration changed.</description>
    <options>no_full_log</options>
    <group>policy_changed,pci_dss_10.2.7,pci_dss_10.6.1,gpg13_4.4,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.14,nist_800_53_AU.6,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>

  <rule id="63608" level="9">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^5008$</field>
    <description>Microsoft security essentials - Service failed.</description>
    <options>no_full_log</options>
    <mitre>
      <id>T1489</id>
    </mitre>
    <group>pci_dss_10.6.1,gpg13_4.14,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>

  <rule id="63609" level="9">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^3002$</field>
    <description>Microsoft security essentials - Real time protection failed.</description>
    <options>no_full_log</options>
    <mitre>
      <id>T1489</id>
    </mitre>
    <group>pci_dss_10.6.1,gpg13_4.14,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>

  <rule id="63610" level="8">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^2012$</field>
    <description>Microsoft security essentials - Cannot use dynamic signature service.</description>
    <options>no_full_log</options>
  </rule>

  <rule id="63611" level="8">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^2004$</field>
    <group>pci_dss_10.6.1,gpg13_4.14,gpg13_4.4,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,tsc_CC7.2,tsc_CC7.3,</group>
    <description>Microsoft security essentials - Loading definitions failed. Using last good set.</description>
    <options>no_full_log</options>
  </rule>

  <rule id="63612" level="8">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^2003$</field>
    <group>pci_dss_10.6.1,gpg13_4.14,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,tsc_CC7.2,tsc_CC7.3,</group>
    <description>Microsoft security essentials - Engine update failed.</description>
    <options>no_full_log</options>
  </rule>

  <rule id="63613" level="8">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^2001$</field>
    <group>pci_dss_10.6.1,gpg13_4.14,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,tsc_CC7.2,tsc_CC7.3,</group>
    <description>Microsoft security essentials - Definitions update failed.</description>
    <options>no_full_log</options>
  </rule>

  <rule id="63614" level="7">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^1005$</field>
    <options>no_full_log</options>
    <description>Microsoft security essentials - Scan error. Scan has stopped.</description>
    <mitre>
      <id>T1489</id>
    </mitre>
    <group>pci_dss_10.6.1,gpg13_4.4,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>

  <rule id="63615" level="5">
    <if_sid>63600,63601,63602</if_sid>
    <field name="win.system.eventID">^1002$</field>
    <options>no_full_log</options>
    <description>Microsoft security essentials - Scan stopped before completion.</description>
    <group>pci_dss_10.6.1,gpg13_4.14,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>

  <rule id="63616" level="5">
    <if_sid>63604,63605</if_sid>
    <field name="win.system.message">\.*DOS/EICAR_Test_File</field>
    <options>no_full_log</options>
    <description>Microsoft security essentials - EICAR test file detected.</description>
  </rule>

  <rule id="63617" level="10" frequency="$MS_FREQ" timeframe="240">
    <if_matched_sid>63602</if_matched_sid>
    <options>no_full_log</options>
    <description>Multiple Microsoft Anti-Malware error events.</description>
  </rule>

  <rule id="63618" level="10" frequency="$MS_FREQ" timeframe="240">
    <if_matched_sid>63601</if_matched_sid>
    <options>no_full_log</options>
    <description>Multiple Microsoft Anti-Malware warning events.</description>
  </rule>

</group>
