---
test_name: PUT /syscheck

stages:

  - name: Try to run a syscheck scan in agent 000
    request:
      verify: False
      method: PUT
      url: "{protocol:s}://{host:s}:{port:d}/syscheck"
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        agents_list: '000'
    response:
      status_code: 200
      json:
        error: 0
        data:
          affected_items:
            - '000'
          failed_items: []
          total_affected_items: 1
          total_failed_items: 0

  - name: Try to run a syscheck scan for a list of agents
    request:
      verify: False
      method: PUT
      url: "{protocol:s}://{host:s}:{port:d}/syscheck"
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        agents_list: '000,002,004,006,008,010,012'
    response:
      status_code: 200
      json:
        error: 2
        data:
          affected_items:
            - '000'
            - '002'
            - '004'
            - '006'
            - '008'
          failed_items:
            - error:
                code: 1707
              id:
                - '010'
                - '012'
          total_affected_items: 5
          total_failed_items: 2

  - name: Try to run a syscheck scan for non existing agents
    request:
      verify: False
      method: PUT
      url: "{protocol:s}://{host:s}:{port:d}/syscheck"
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        agents_list: '002,040,050,060'
    response:
      status_code: 200
      json:
        error: 2
        data:
          affected_items:
            - '002'
          failed_items:
            - error:
                code: 1701
              id:
                - '040'
                - '050'
                - '060'
          total_affected_items: 1
          total_failed_items: 3

  - name: Run a syscheck scan in all agents
    request:
      verify: False
      method: PUT
      url: "{protocol:s}://{host:s}:{port:d}/syscheck"
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      json:
        error: 0
        data:
          affected_items: !anything
          failed_items: []
          total_affected_items: 9
          total_failed_items: 0
