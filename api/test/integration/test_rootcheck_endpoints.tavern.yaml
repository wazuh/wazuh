---
test_name: PUT /rootcheck

stages:

  # PUT /rootcheck?agents_list=002
  - name: Run rootcheck scan in agent 002
    request:
      verify: False
      method: PUT
      url: "{protocol:s}://{host:s}:{port:d}/rootcheck"
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        agents_list: "002"
    response:
      status_code: 200
      json:
        error: 0
        data:
          affected_items:
            - "002"
          failed_items: []
          total_affected_items: 1
          total_failed_items: 0

  # PUT /rootcheck
  - name: Run rootcheck scan in all agents
    request:
      verify: False
      method: PUT
      url: "{protocol:s}://{host:s}:{port:d}/rootcheck"
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      json:
        error: 0
        data:
          affected_items:
            - "000"
            - "001"
            - "002"
            - "003"
            - "004"
            - "005"
            - "006"
            - "007"
            - "008"
          failed_items: []
          total_affected_items: 9
          total_failed_items: 0

  # PUT /rootcheck
  - name: Try to run a rootcheck scan for non active agents
    request:
      verify: False
      method: PUT
      url: "{protocol:s}://{host:s}:{port:d}/rootcheck"
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        agents_list: '010,012'
    response:
      status_code: 200
      json:
        error: 1
        data:
          affected_items: []
          failed_items:
            - error:
                code: 1707
              id:
                - "010"
                - "012"
          total_affected_items: 0
          total_failed_items: 2

  # PUT /rootcheck
  - name: Try to run rootcheck scan for non existing agents
    request:
      verify: False
      method: PUT
      url: "{protocol:s}://{host:s}:{port:d}/rootcheck"
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        agents_list: '040,050'
    response:
      status_code: 200
      json:
        error: 1
        data:
          affected_items: []
          failed_items:
            - error:
                code: 1701
              id:
                - "040"
                - "050"
          total_affected_items: 0
          total_failed_items: 2
    delay_after: !float "{global_db_delay}"
