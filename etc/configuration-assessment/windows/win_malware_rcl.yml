# Configuration assessment
# CIS Checks for Windows malware
# Copyright (C) 2015-2019, Wazuh Inc.
#
# This program is a free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public
# License (version 2) as published by the FSF - Free Software
# Foundation
#

policy:
  id: "win_malware"
  file: "win_malware_rcl.yml"
  name: "Benchmark for Windows malware"
  description: "This document provides a way of ensuring the security of the Windows systems against malware."
  references:
   - https://www.cisecurity.org/cis-benchmarks/

checks:
 - id: 11000
   title: "Ginwui Backdoor"
   compliance:
    - pci_dss: "11.4"
   references:
    - http://www.iss.net/threats/ginwui.html
   condition: any
   rules:
     - 'f:%WINDIR%\System32\zsyhide.dll;'
     - 'f:%WINDIR%\Sysnative\zsyhide.dll;'
     - 'f:%WINDIR%\System32\zsydll.dll;'
     - 'f:%WINDIR%\Sysnative\zsydll.dll;'
     - 'r:HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify\zsydll;'
     - 'r:HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows -> AppInit_DLLs -> r:zsyhide.dll;'
# http://www.symantec.com/security_response/writeup.jsp?docid=2006-081312-3302-99&tabid=2
 - id: 11001
   title: "Wargbot Backdoor"
   description: "W32.Wargbot is a worm with back door capabilities that exploits the Microsoft Windows Server Service Remote Buffer Overflow Vulnerability (BID 19409). The worm may attempt to download a copy of Backdoor.Ranky.X (MCID 8520)."
   compliance:
    - pci_dss: "11.4"
   references:
    - http://www.symantec.com/security_response/writeup.jsp?docid=2006-081312-3302-99&tabid=2
   condition: any
   rules:
     - 'f:%WINDIR%\System32\wgareg.exe;'
     - 'f:%WINDIR%\Sysnative\wgareg.exe;'
     - 'r:HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\wgareg;'
# http://www.f-prot.com/virusinfo/descriptions/sober_j.html
 - id: 11002
   title: "Sober Worm"
   description: "W32/Sober.J@mm is a mass-mailing worm that can send out e-mails both in english and german. When executed the worm creates several files."
   compliance:
    - pci_dss: "11.4"
   references:
    - http://www.f-prot.com/virusinfo/descriptions/sober_j.html
   condition: any
   rules:
     - 'f:%WINDIR%\System32\nonzipsr.noz;'
     - 'f:%WINDIR%\Sysnative\nonzipsr.noz;'
     - 'f:%WINDIR%\System32\clonzips.ssc;'
     - 'f:%WINDIR%\Sysnative\clonzips.ssc;'
     - 'f:%WINDIR%\System32\clsobern.isc;'
     - 'f:%WINDIR%\Sysnative\clsobern.isc;'
     - 'f:%WINDIR%\System32\sb2run.dii;'
     - 'f:%WINDIR%\Sysnative\sb2run.dii;'
     - 'f:%WINDIR%\System32\winsend32.dal;'
     - 'f:%WINDIR%\Sysnative\winsend32.dal;'
     - 'f:%WINDIR%\System32\winroot64.dal;'
     - 'f:%WINDIR%\Sysnative\winroot64.dal;'
     - 'f:%WINDIR%\System32\zippedsr.piz;'
     - 'f:%WINDIR%\Sysnative\zippedsr.piz;'
     - 'f:%WINDIR%\System32\winexerun.dal;'
     - 'f:%WINDIR%\Sysnative\winexerun.dal;'
     - 'f:%WINDIR%\System32\winmprot.dal;'
     - 'f:%WINDIR%\Sysnative\winmprot.dal;'
     - 'f:%WINDIR%\System32\dgssxy.yoi;'
     - 'f:%WINDIR%\Sysnative\dgssxy.yoi;'
     - 'f:%WINDIR%\System32\cvqaikxt.apk;'
     - 'f:%WINDIR%\Sysnative\cvqaikxt.apk;'
     - 'f:%WINDIR%\System32\sysmms32.lla;'
     - 'f:%WINDIR%\Sysnative\sysmms32.lla;'
     - 'f:%WINDIR%\System32\Odin-Anon.Ger;'
     - 'f:%WINDIR%\Sysnative\Odin-Anon.Ger;'
 - id: 11003
   title: "Hotword Trojan"
   description: "Trojan.Hotword is a Trojan horse that logs keystrokes and opens a back door on the compromised computer."
   compliance:
    - pci_dss: "11.4"
   condition: any
   rules:
     - 'f:%WINDIR%\System32\_;'
     - 'f:%WINDIR%\Sysnative\_;'
     - 'f:%WINDIR%\System32\explore.exe;'
     - 'f:%WINDIR%\Sysnative\explore.exe;'
     - 'f:%WINDIR%\System32\ svchost.exe;'
     - 'f:%WINDIR%\Sysnative\ svchost.exe;'
     - 'f:%WINDIR%\System32\mmsystem.dlx;'
     - 'f:%WINDIR%\Sysnative\mmsystem.dlx;'
     - 'f:%WINDIR%\System32\WINDLL-ObjectsWin*.DLX;'
     - 'f:%WINDIR%\Sysnative\WINDLL-ObjectsWin*.DLX;'
     - 'f:%WINDIR%\System32\CFXP.DRV;'
     - 'f:%WINDIR%\Sysnative\CFXP.DRV;'
     - 'f:%WINDIR%\System32\CHJO.DRV;'
     - 'f:%WINDIR%\Sysnative\CHJO.DRV;'
     - 'f:%WINDIR%\System32\MMSYSTEM.DLX;'
     - 'f:%WINDIR%\Sysnative\MMSYSTEM.DLX;'
     - 'f:%WINDIR%\System32\OLECLI.DL;'
     - 'f:%WINDIR%\Sysnative\OLECLI.DL;'
 - id: 11004
   title: "Beagle worm"
   compliance:
    - pci_dss: "11.4"
   condition: any
   rules:
     - 'f:%WINDIR%\System32\winxp.exe;'
     - 'f:%WINDIR%\Sysnative\winxp.exe;'
     - 'f:%WINDIR%\System32\winxp.exeopen;'
     - 'f:%WINDIR%\Sysnative\winxp.exeopen;'
     - 'f:%WINDIR%\System32\winxp.exeopenopen;'
     - 'f:%WINDIR%\Sysnative\winxp.exeopenopen;'
     - 'f:%WINDIR%\System32\winxp.exeopenopenopen;'
     - 'f:%WINDIR%\Sysnative\winxp.exeopenopenopen;'
     - 'f:%WINDIR%\System32\winxp.exeopenopenopenopen;'
     - 'f:%WINDIR%\Sysnative\winxp.exeopenopenopenopen;'
 - id: 11005
   title: "Gpcoder Trojan"
   description: "Trojan.Gpcoder.E is a Trojan horse that encrypts files and then prompts the user to purchase a password in order to decrypt them."
   compliance:
    - pci_dss: "11.4"
   references:
    - http://symantec.com/security_response/writeup.jsp?docid=2007-071711-3132-99
   condition: any
   rules:
     - 'f:%WINDIR%\System32\ntos.exe;'
     - 'f:%WINDIR%\Sysnative\ntos.exe;'
     - 'f:%WINDIR%\System32\wsnpoem;'
     - 'f:%WINDIR%\Sysnative\wsnpoem;'
     - 'f:%WINDIR%\System32\wsnpoem\audio.dll;'
     - 'f:%WINDIR%\Sysnative\wsnpoem\audio.dll;'
     - 'f:%WINDIR%\System32\wsnpoem\video.dll;'
     - 'f:%WINDIR%\Sysnative\wsnpoem\video.dll;'
     - 'r:HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run -> userinit -> r:ntos.exe;'
# [http://www.symantec.com/security_response/writeup.jsp?docid=2006-112813-0222-99&tabid=2
 - id: 11006
   title: "Looked.BK Worm"
   description: "W32.Looked.BK is a network-aware worm that infects executable files in local drives and network shares."
   compliance:
    - pci_dss: "11.4"
   references:
    - https://www.symantec.com/security-center/writeup/2006-112813-0222-99?tabid=2
   condition: any
   rules:
     - 'f:%WINDIR%\uninstall\rundl132.exe;'
     - 'f:%WINDIR%\Logo1_.exe;'
     - 'f:%Windir%\RichDll.dll;'
     - 'r:HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run -> load -> r:rundl132.exe;'
 - id: 11007
   title: "Possible Malware - Svchost running outside system32"
   compliance:
    - pci_dss: "11.4"
   condition: all
   rules:
     - 'p:r:svchost.exe && !%WINDIR%\System32\svchost.exe;'
     - 'f:!%WINDIR%\SysWOW64;'
 - id: 11008
   title: "Possible Malware - Inetinfo running outside system32\inetsrv"
   compliance:
    - pci_dss: "11.4"
   condition: all
   rules:
     - 'p:r:inetinfo.exe && !%WINDIR%\System32\inetsrv\inetinfo.exe;'
     - 'f:!%WINDIR%\SysWOW64;'
 - id: 11009
   title: "Possible Malware - Rbot/Sdbot detected"
   compliance:
    - pci_dss: "11.4"
   condition: any
   rules:
     - 'f:%Windir%\System32\rdriv.sys;'
     - 'f:%Windir%\Sysnative\rdriv.sys;'
     - 'f:%Windir%\lsass.exe;'
 - id: 11010
   title: "Possible Malware File"
   compliance:
    - pci_dss: "11.4"
   condition: any
   rules:
     - 'f:%WINDIR%\utorrent.exe;'
     - 'f:%WINDIR%\System32\utorrent.exe;'
     - 'f:%WINDIR%\Sysnative\utorrent.exe;'
     - 'f:%WINDIR%\System32\Files32.vxd;'
     - 'f:%WINDIR%\Sysnative\Files32.vxd;'
# Modified /etc/hosts entries
# Idea taken from:
# http://www.f-secure.com/v-descs/fantibag_b.shtml
 - id: 11011
   title: "Anti-virus site on the hosts file"
   description: "Fantibag.B is a trojan that installs a packet filter for preventing of downloading the AV companies database updates and security patches. It is related to recent Bagle/Mitglieder trojans."
   rationale: "Based on the settings of your F-Secure security product, it will either move the file to the quarantine where it cannot spread or cause harm, or remove it."
   references:
    - http://www.f-secure.com/v-descs/fantibag_b.shtml
   condition: any
   rules:
     - 'f:%WINDIR%\System32\Drivers\etc\HOSTS -> r:avp.ch|avp.ru|nai.com;'
     - 'f:%WINDIR%\Sysnative\Drivers\etc\HOSTS -> r:avp.ch|avp.ru|nai.com;'
     - 'f:%WINDIR%\System32\Drivers\etc\HOSTS -> r:awaps.net|ca.com|mcafee.com;'
     - 'f:%WINDIR%\Sysnative\Drivers\etc\HOSTS -> r:awaps.net|ca.com|mcafee.com;'
     - 'f:%WINDIR%\System32\Drivers\etc\HOSTS -> r:microsoft.com|f-secure.com;'
     - 'f:%WINDIR%\Sysnative\Drivers\etc\HOSTS -> r:microsoft.com|f-secure.com;'
     - 'f:%WINDIR%\System32\Drivers\etc\HOSTS -> r:sophos.com|symantec.com;'
     - 'f:%WINDIR%\Sysnative\Drivers\etc\HOSTS -> r:sophos.com|symantec.com;'
     - 'f:%WINDIR%\System32\Drivers\etc\HOSTS -> r:my-etrust.com|viruslist.ru;'
     - 'f:%WINDIR%\Sysnative\Drivers\etc\HOSTS -> r:my-etrust.com|viruslist.ru;'
     - 'f:%WINDIR%\System32\Drivers\etc\HOSTS -> r:networkassociates.com;'
     - 'f:%WINDIR%\Sysnative\Drivers\etc\HOSTS -> r:networkassociates.com;'
     - 'f:%WINDIR%\System32\Drivers\etc\HOSTS -> r:kaspersky|grisoft.com;'
     - 'f:%WINDIR%\Sysnative\Drivers\etc\HOSTS -> r:kaspersky|grisoft.com;'
     - 'f:%WINDIR%\System32\Drivers\etc\HOSTS -> r:symantecliveupdate.com;'
     - 'f:%WINDIR%\Sysnative\Drivers\etc\HOSTS -> r:symantecliveupdate.com;'
     - 'f:%WINDIR%\System32\Drivers\etc\HOSTS -> r:clamav.net|bitdefender.com;'
     - 'f:%WINDIR%\Sysnative\Drivers\etc\HOSTS -> r:clamav.net|bitdefender.com;'
     - 'f:%WINDIR%\System32\Drivers\etc\HOSTS -> r:antivirus.com|sans.org;'
     - 'f:%WINDIR%\Sysnative\Drivers\etc\HOSTS -> r:antivirus.com|sans.org;'
