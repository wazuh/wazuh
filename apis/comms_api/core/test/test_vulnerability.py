import pytest
from unittest.mock import patch, AsyncMock

from comms_api.core.vulnerability import request_vulnerability_scan
from wazuh.core.engine.models.vulnerability import ScanRequest, Type


@pytest.mark.asyncio
@patch('wazuh.core.engine.vulnerability.VulnerabilityModule.send_scan_request', new_callable=AsyncMock)
async def test_request_vulnerability_scan(vuln_send_scan_request):
    """Check that the `request_vulnerability_scan` function works as expected."""
    scan_request = ScanRequest(
        type=Type.PACKAGE_LIST,
        packages=[],
    )
    response = await request_vulnerability_scan(scan_request)

    vuln_send_scan_request.assert_called_once_with(scan_request)
    assert response
